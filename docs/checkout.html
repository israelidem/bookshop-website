<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://checkout.flutterwave.com/v3.js"></script>
</head>
<body>
  <div id="checkout" style="padding:1rem"></div>

  <script>
    // Helper to get query parameters
    function getQueryParam(name){ 
      const params = new URLSearchParams(location.search); 
      return params.get(name); 
    }

    const id = parseInt(getQueryParam('id')); // Using ?id=101 etc.

    fetch('books.json')
      .then(res => res.json())
      .then(items => {
        const p = items.find(x => x.id === id);
        const el = document.getElementById('checkout');

        if(!p){ 
          el.innerHTML = '<p>Product not found.</p>'; 
          return; 
        }

        el.innerHTML = `
          <h2>Checkout</h2>
          <p>${p.title} — ₦${p.price}</p>
          <p>After payment you'll be able to download the file.</p>
          <button id="payButton" style="padding:.5rem 1rem; background:#0b5ed7; color:white; border:none; border-radius:6px">Proceed to Pay</button>
        `;

        document.getElementById('payButton').addEventListener('click', () => {
          // Flutterwave payment
          FlutterwaveCheckout({
            public_key: "FLWPUBK_TEST-45fb3374f78bda92f175771f7a9bf51b-X",
            tx_ref: "tx-" + Date.now(),
            amount: Number(p.price),
            currency: "NGN",
            payment_options: "card",
            customer: {
              email: "customer@example.com",
              name: "BookHub Store",
            },
            callback: function(response) {
              if(response.status === "successful"){
                // Redirect to download link after payment
                window.location.href = p.downloadUrl;
              } else {
                alert("Payment was not successful.");
              }
            },
            onclose: function() {}
          });
        });

      })
      .catch(err => {
        console.error("Error loading books.json:", err);
        document.getElementById('checkout').innerHTML = '<p>Failed to load product data.</p>';
      });
  </script>
</body>
</html>
